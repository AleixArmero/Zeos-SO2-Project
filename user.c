#include <libc.h>

char buff[24];
sem_t *s;
char *md;
int value = 0;

int x, y;

sem_t *sem_move;

#define TARGET_FRAMERATE 5.0f
#define PLAYER_COLOR 0x5

char map[25][80][2] = {
{{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'[', 0x0A},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},},
};

void print_on_point(int pos_x, int pos_y, char *a) {
	gotoXY(pos_x, pos_y);
	write(1, a, 1);
}

void move_player(int new_x, int new_y) {
	changeColor(0x0, 0x0);
	print_on_point(x, y, " ");
	changeColor(PLAYER_COLOR, 0x0);
	print_on_point(new_x, new_y, "A");
	x = new_x;
	y = new_y;
}

void move(int wait_time) {
	char key;
	if (getKey(&key, wait_time) > -1) {

		switch (key)
		{
		case 'w':
			/* code */
			if (map[y-1][x][0] != '#') {
				move_player(x, y-1);
			}
			break;
		
		case 'a':
			if (map[y][x-1][0] != '#') {
				move_player(x-1, y);
			}
			break;

		case 's':
			if (map[y+1][x][0] != '#') {
				move_player(x, y+1);
			}
			break;

		case 'd':
			if (map[y][x+1][0] != '#') {
				move_player(x+1, y);
			}
			break;
		}
	}

	return;
}

int __attribute__ ((__section__(".text.main")))
  main(void)
{
    /* Next line, tries to move value 0 to CR3 register. This register is a privileged one, and so it will raise an exception */
     /* __asm__ __volatile__ ("mov %0, %%cr3"::"r" (0) ); */


  /*He limitat el nombre de variables dinamiques a 2 per poder fer probes fácilment*/

  write(1, "MAP TEST\n", 9);

  x = 1;
  y = 23;

  clrscr((char *)map);

  float time_previous_frame, time_current_frame, time_per_frame;

  time_per_frame = 1.f/TARGET_FRAMERATE;

  time_previous_frame = gettime();

  changeColor(0x5, 0x0);
  gotoXY(x, y);
  write(1, "A", 1);

  while(1) {

	time_current_frame = gettime();

	if (time_current_frame - time_previous_frame >= time_per_frame) {
		int time_to_end = (time_current_frame - time_previous_frame) - time_per_frame;
		move(time_to_end);
		time_previous_frame = time_current_frame;
	}
	
  }
}
