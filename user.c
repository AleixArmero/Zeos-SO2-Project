#include <libc.h>

#define PLAYER_COLOR 0x3
#define GROUND 0x0
#define ENEMY_COLOR 0x2
#define WIN_COLOR 0xA
#define BG_WIN 0x1
#define BG_LOSE 0x1
#define LOSE_COLOR 0xC
#define RESPONSE_DELAY 50

sem_t *sem_mutex, *sem_move_agent;
int agent[4][2] = {{1, 23}, {5, 5}, {20, 23}, {75, 10}};
int last_position[4][2];
int last_enemy = 0;
char key;
enum state {PLAY, WIN, LOSE} game_state = PLAY;

char map[25][80][2] = {
{{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},{'[', 0x0A},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{' ', 0x00},{'#', 0x0F},},
{{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},{'#', 0x0F},},
};

void *print_screen (void *s) {
  
  clrscr((char *)s);
  
  changeColor(PLAYER_COLOR, 0x0);
  gotoXY(agent[0][0], agent[0][1]);
  write(1, "P", 1);
  
  changeColor(ENEMY_COLOR, 0x0);
  gotoXY(agent[1][0], agent[1][1]);
  write(1, "E", 1);
  gotoXY(agent[2][0], agent[2][1]);
  write(1, "E", 1);
  gotoXY(agent[3][0], agent[3][1]);
  write(1, "E", 1);
  
  while(1) {  
    semWait (sem_mutex);
    
    if (last_position[0][0] != agent[0][0] || last_position[0][1] != agent[0][1]) {
      changeColor(GROUND, 0x0); 
      gotoXY(last_position[0][0], last_position[0][1]);
      write(1, " ", 1);
      changeColor(PLAYER_COLOR, 0x0);
      gotoXY(agent[0][0], agent[0][1]);
      write(1, "P", 1);
    }
    
    if (game_state == WIN) {
      changeColor(WIN_COLOR, BG_WIN);
      gotoXY (30,12);
      write (1, "*************\n", 14);
      gotoXY (30,13);
      write (1, "* YOU WIN ! *\n", 14);
      gotoXY (30,14);
      write (1, "*************\n", 14);
      exit();
    }
    
    for (int i = 1; i <= 3; i++) 
      if (last_position[i][0] != agent[i][0] || last_position[i][1] != agent[i][1]) {
        changeColor(GROUND, 0x0);
        gotoXY(last_position[i][0], last_position[i][1]);
        write(1, " ", 1);
        changeColor(ENEMY_COLOR, 0x0);
        gotoXY(agent[i][0], agent[i][1]);
        write(1, "E", 1);
      }
    
    if (game_state == LOSE) {
      changeColor(LOSE_COLOR, BG_LOSE);
      gotoXY (30,12);
      write (1, "***************\n", 16);
      gotoXY (30,13);
      write (1, "* GAME OVER ! *\n", 16);
      gotoXY (30,14);
      write (1, "***************\n", 16);
      exit();
    }
  
    semSignal (sem_mutex);
  }
}

void *move_agent (int s[][2]) {
  int px, py, ex, ey, targetx, targety;
 
  while (1) {
	  semWait (sem_move_agent);
	  semWait (sem_mutex);
	  
	  last_position[0][0] = agent[0][0]; last_position[0][1] = agent[0][1];
	  last_position[1][0] = agent[1][0]; last_position[1][1] = agent[1][1];
	  last_position[2][0] = agent[2][0]; last_position[2][1] = agent[2][1];
	  last_position[3][0] = agent[3][0]; last_position[3][1] = agent[3][1];
	  
		px = s[0][0];
		py = s[0][1];
	  
	  switch (key)
		{
		  case 'w':
		    if (map[py-1][px][0] != '#')
		 	    py--;
		  	break;
		  case 'a':
			  if (map[py][px-1][0] != '#')
			    px--;
			  break;
		  case 's':
			  if (map[py+1][px][0] != '#')
		      py++;
			  break;
      case 'd':
			  if (map[py][px+1][0] != '#')
			    px++;
			  break;
	  }
	  s[0][0] = px;
	  s[0][1] = py;
	  
	  int i = last_enemy+1;
	  ex = s[i][0];
	  ey = s[i][1];
	      
    if (ex - px > 0)
      targetx = ex-1;
    else
      targetx = ex+1;
       
    if (ey - py > 0)
      targety = ey-1;
    else
      targety = ey+1;
       
    if (map[targety][targetx][0] == '#' && map[targety][ex][0] != '#')
      targetx = ex;
    else if (map[targety][targetx][0] == '#' && map[ey][targetx][0] != '#')
      targety = ey;
    else if (map[targety][targetx][0] == '#') {
      targetx = ex;
      targety = ey;
    }
	      
    s[i][0] = targetx;
    s[i][1] = targety;
    
    for (int j = 1; j <= 3; j++)
	    if (s[i][0] == s[0][0] && s[i][1] == s[0][1]) {
        game_state = LOSE;
        break;
    }
    else if (map[s[0][1]][s[0][0]][0] == '[')
	    game_state = WIN;
	 
	  last_enemy = (last_enemy+1)%3;
	
	  semSignal (sem_mutex);
	}
}

void *key_read (void *s) {
	
	while (1) {
	  if (getKey((char *)s, RESPONSE_DELAY) > -1)
	    semSignal (sem_move_agent);  
	}
}

void *test (void *s)
{
  // nothing to do here
  return s;
}

void __attribute__ ((__section__(".text.exit")))
  exit_from_thread (void)
{
  exit();
}

int __attribute__ ((__section__(".text.main")))
  main(void)
{
    /* Next line, tries to move value 0 to CR3 register. This register is a privileged one, and so it will raise an exception */
     /* __asm__ __volatile__ ("mov %0, %%cr3"::"r" (0) ); */

  sem_move_agent = semCreate(0);
  sem_mutex = semCreate(1);
  
  create_thread (print_screen, 1, (void *) map);
  create_thread (key_read, 1, (void *) &key);
  create_thread ((void *) move_agent, 1, (void *) agent);  

  // Threat to test return without exit
  int v;
  create_thread (test, 1, &v);

  while(1) {
  }
	
} 
